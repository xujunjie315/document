# 深入微服务架构的进程间通信 

## 1.交互模式

### 第一个维度是一对一还是一对多：

* 一对一：每个客户端请求有一个服务实例来响应。
* 一对多：每个客户端请求有多个服务实例来响应。

### 第二个维度是这些交互式同步还是异步：

* 同步模式：客户端请求需要服务端即时响应，甚至可能由于等待而阻塞。
* 异步模式：客户端请求不会阻塞进程，服务端的响应可以是非即时的。

### 一对一的交互模式有以下几种方式：

* 请求/响应：一个客户端向服务器端发起请求，等待响应。客户端期望此响应即时到达。在一个基于线程的应用中，等待过程可能造成线程阻塞。
* 通知（也就是常说的单向请求）：一个客户端请求发送到服务端，但是并不期望服务端响应。
* 请求/异步响应：客户端发送请求到服务端，服务端异步响应请求。客户端不会阻塞，而且被设计成默认响应不会立刻到达。

### 一对多的交互模式有以下几种方式：

* 发布/ 订阅模式：客户端发布通知消息，被零个或者多个感兴趣的服务消费。

* 发布/异步响应模式：客户端发布请求消息，然后等待从感兴趣服务发回的响应。

## 2.消息机制

使用消息机制有很多优点：
* 解耦客户端和服务端
* Message Buffering
* 直接进程间通信
消息机制也有自己的缺点：
* 额外的操作复杂性
* 实现基于请求/响应交互模式的复杂性

## 3.REST

现在很流行使用RESTful风格的API。REST是基于HTTP协议的。另外，一个需要理解的比较重要的概念是，REST是一个资源，一般代表一个业务对象，比如一个客户或者一个产品，或者一组商业对象。REST使用HTTP语法协议来修改资源，一般通过URL来实现。
基于HTTP的协议有如下好处：

* HTTP非常简单并且大家都很熟悉。
* 可以使用浏览器扩展（比如Postman）或者curl之类的命令行来测试API。
* 内置支持请求/响应模式的通信。
* HTTP对防火墙友好的。
* 不需要中间代理，简化了系统架构。

不足之处包括：

* 只支持请求/响应模式交互。可以使用HTTP通知，但是服务端必须一直发送HTTP响应才行。
* 因为客户端和服务端直接通信（没有代理或者buffer机制），在交互期间必须都在线。
* 客户端必须知道每个服务实例的URL。如之前那篇关于API Gateway的文章所述，这也是个烦人的问题。客户端必须使用服务实例发现机制。

## 4.Thrift

Apache Thrift是一个很有趣的REST的替代品。它是Facebook实现的一种高效的、支持多种编程语言的远程服务调用的框架。Thrift提供了一个C风格的IDL定义API。Thrift支持多种消息格式：JSON、二进制和压缩二进制。二进制比JSON更高效，因为二进制解码更快。

## 5.参考

* [文档](http://www.dockone.io/article/549)